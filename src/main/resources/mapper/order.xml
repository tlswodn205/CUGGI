<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.tencoding.CUGGI.repository.interfaces.OrderRepository">

	<insert id="insert">
		INSERT INTO order_tb(user_id, state, created_at)
		values(#{userId},#{state},now())
	</insert>

	<update id="updateById">
		UPDATE order_tb SET cancelDate = #{cancel_date},
		state = #{state}, purchaseDate = #{purchase_date}
		WHERE id = #{id}
	</update>

	<delete id="deleteById">
		DELETE FROM order_tb WHERE id = #{id}
	</delete>

	<select id="findById"
		resultType="com.tencoding.CUGGI.repository.model.Order">
		SELECT * FROM order_tb WHERE id = #{id}
	</select>

	<select id="findByAll"
		resultType="com.tencoding.CUGGI.repository.model.Order">
		SELECT * FROM order_tb
	</select>

	<select id="findByList"
		resultType="com.tencoding.CUGGI.dto.response.OrderListResponseDto">
		select o.created_at , ot.product_name ,p.product_feature,
		ot.product_name, ot. price, pi.image
		from order_tb o
		left join order_products_tb ot
		on o.id = ot.order_id
		left join product_tb p
		on ot.product_id = p.id
		left join product_image_tb pi
		on p.id = pi.product_id
		where o.user_id = #{id}
		and pi.is_thumbnail = 1
	</select>
</mapper>